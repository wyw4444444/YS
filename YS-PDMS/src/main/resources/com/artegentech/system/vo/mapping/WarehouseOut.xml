<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.artegentech.system.dao.IWarehouseOutDAO">
	<cache />
	<insert id="doCreate" parameterType="WarehouseOut">
		INSERT INTO tblwarehouse_out(out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date)
		VALUES(#{out_id},#{out_date},#{part_code},#{total_quantity},#{out_reason},#{pdr_no},#{member_id},#{note},#{locked},#{lock_date});
	</insert>
	<update id="doUpdate" parameterType="WarehouseOut">
		UPDATE tblwarehouse_out SET out_date=#{out_date},part_code=#{part_code},total_quantity=#{total_quantity},out_reason=#{out_reason},pdr_no=#{pdr_no},member_id=#{member_id},note=#{note},locked=#{locked},lock_date=#{lock_date} WHERE out_id=#{out_id};
	</update>
	<select id="getDayIdNum" parameterType="String" resultType="Long">
		SELECT COUNT(*) FROM tblwarehouse_out WHERE out_id LIKE #{pre_out_id};
	</select>
	<select id="findById" resultType="WarehouseOut" parameterType="String">
		SELECT out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date FROM tblwarehouse_out WHERE out_id=#{out_id};
	</select>
	<select id="findAll" resultType="WarehouseOut">
		SELECT out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date FROM tblwarehouse_out;
	</select>
	<select id="findAllUnlocked" resultType="WarehouseOut">
		SELECT out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date FROM tblwarehouse_out WHERE locked=0;
	</select>
	<select id="findAllNoLockedByPartCode" resultType="WarehouseOut" parameterType="String">
		SELECT out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date FROM tblwarehouse_out
		WHERE locked=0 AND part_code=#{part_code};
	</select>
	<select id="findAllSplit" parameterType="java.util.Map" resultType="WarehouseOut">
		SELECT out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date FROM tblwarehouse_out
		<where>
			<if test="start_date==null or end_date==null">
				<if test="column != null and keyword !=null">
					${column} = #{keyword}
				</if>
			</if>
			<if test="start_date != null and end_date != null">
				out_date BETWEEN #{start_date} AND #{end_date} 
				<if test="column != null and keyword !=null">
					and ${column} = #{keyword}
				</if>
			</if>
		</where>
		ORDER BY out_id ASC
		LIMIT #{start},#{lineSize};
	</select>
	<select id="getAllCount" parameterType="java.util.Map" resultType="Long">
		SELECT COUNT(*) FROM tblwarehouse_out
		<where>
			<if test="start_date==null or end_date==null">
				<if test="column != null and keyword !=null">
					${column} = #{keyword}
				</if>
			</if>
			<if test="start_date != null and end_date != null">
				out_date BETWEEN #{start_date} AND #{end_date} 
				<if test="column != null and keyword !=null">
					and ${column} = #{keyword}
				</if>
			</if>
		</where>
	</select>
	<select id="getAllNoLockedByPartCodeCount" parameterType="String" resultType="Long">
		SELECT COUNT(*) FROM tblwarehouse_out
		WHERE locked=0 AND part_code=#{part_code};
	</select>
	<select id="getSumQuantityByPartCode" parameterType="String" resultType="Double">
		SELECT SUM(total_quantity) FROM tblwarehouse_out WHERE locked=0;
	</select>
	<select id="findAllByPDR" resultType="WarehouseOut" parameterType="java.util.Map">
		SELECT out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date FROM tblwarehouse_out
		WHERE pdr_no=#{pdr_no} ORDER BY out_id DESC;
	</select>
	<select id="findAllByPDRNoPartCode" resultType="WarehouseOut" parameterType="java.util.Map">
		SELECT out_id,out_date,part_code,total_quantity,out_reason,pdr_no,member_id,note,locked,lock_date FROM tblwarehouse_out
		WHERE pdr_no=#{pdr_no} AND part_code=#{part_code} ORDER BY out_id DESC;
	</select>
	<select id="getSumQuantityByPDRNoPartCode" parameterType="java.util.Map" resultType="Double">
		SELECT SUM(total_quantity) FROM tblwarehouse_out WHERE pdr_no=#{pdr_no} AND part_code=#{part_code};
	</select>
</mapper>